<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Avaliebus - Gest√£o de Qualidade</title>
    <style>
        :root { 
            --primary: #00b894; --secondary: #0984e3; --warning: #fdcb6e; 
            --danger: #d63031; --purple: #6c5ce7; --dark: #2d3436; 
            --light: #f1f2f6; --success-light: #55efc4;
        }
        body { font-family: 'Segoe UI', sans-serif; background: var(--light); margin: 0; padding: 0; }
        
        .nav-toggle { position: absolute; top: 15px; right: 15px; display: flex; gap: 5px; z-index: 100; }
        .nav-toggle a { color: rgba(255,255,255,0.7); text-decoration: none; cursor: pointer; padding: 4px 12px; border-radius: 15px; font-size: 0.65rem; font-weight: bold; border: 1px solid rgba(255,255,255,0.3); transition: 0.3s; background: rgba(0,0,0,0.1); }
        .nav-toggle a.active { background: white; color: var(--dark); border-color: white; box-shadow: 0 2px 10px rgba(0,0,0,0.2); }

        .app-container { max-width: 500px; margin: 0 auto; background: #fff; min-height: 100vh; position: relative; box-shadow: 0 0 30px rgba(0,0,0,0.1); display: flex; flex-direction: column; }
        .header { background: var(--primary); color: white; padding: 45px 20px 25px; text-align: center; }
        .header h1 { margin: 0; font-size: 1.8rem; letter-spacing: 1px; }
        .header p { margin: 5px 0 0; font-size: 0.85rem; opacity: 0.9; }
        
        .card { margin: 15px; padding: 20px; border-radius: 15px; background: white; box-shadow: 0 4px 15px rgba(0,0,0,0.05); border: 1px solid #eee; }
        
        /* Efeitos de Hover e Brilho nos Bot√µes */
        .btn { border: none; border-radius: 12px; padding: 18px; font-weight: bold; cursor: pointer; width: 100%; transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); font-size: 1rem; margin-top: 10px; outline: none; display: block; box-sizing: border-box; }
        .btn:hover { transform: translateY(-4px); box-shadow: 0 8px 20px rgba(0,0,0,0.15); filter: brightness(1.1); }

        .farol-container { display: flex; gap: 6px; margin-bottom: 10px; }
        .btn-lot { border: 3px solid transparent; padding: 12px 2px; font-size: 0.65rem; flex: 1; text-transform: uppercase; border-radius: 8px; cursor: pointer; font-weight: 800; transition: all 0.3s ease; }
        .btn-lot:hover { transform: scale(1.08); box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        
        .btn-vazio { background: var(--primary); color: white; }
        .btn-medio { background: var(--warning); color: var(--dark); }
        .btn-lotado { background: var(--danger); color: white; }
        .btn-super { background: var(--purple); color: white; }
        
        .btn-selected { border-color: #000 !important; transform: scale(1.1) !important; box-shadow: 0 0 20px rgba(0,0,0,0.2) !important; z-index: 2; }

        /* Painel ADM Azul */
        .header-adm { background: var(--secondary) !important; }
        .dash-card { border-left: 8px solid var(--secondary); margin: 15px; background: #fff; padding: 15px; border-radius: 10px; border: 1px solid #eee; cursor: pointer; }
        .ranking-resumo { background: #f0f7ff; padding: 12px; border-radius: 10px; margin: 10px 0; display: grid; grid-template-columns: 1fr 1fr; gap: 8px; border: 1px solid #d1e7ff; }
        .rank-item { font-size: 0.75rem; color: #444; }
        .rank-item b { color: var(--secondary); font-size: 0.85rem; }
        .alerta-problema { grid-column: span 2; background: #fff; padding: 6px; border-radius: 6px; border: 1px dashed var(--danger); color: var(--danger); font-weight: bold; font-size: 0.75rem; text-align: center; margin-top: 5px; }

        .details-area { display: none; margin-top: 15px; padding-top: 15px; border-top: 1px dashed #ccc; }
        .detail-item { background: #f8f9fa; padding: 12px; border-radius: 8px; margin-bottom: 10px; border: 1px solid #eee; font-size: 0.8rem; line-height: 1.5; }
        .tag-nota { background: #e0e0e0; padding: 2px 6px; border-radius: 4px; font-size: 0.65rem; margin-right: 4px; font-weight: bold; display: inline-block; }

        .section-title { color: var(--secondary); border-left: 5px solid var(--secondary); padding-left: 12px; margin: 25px 0 10px 0; font-size: 0.95rem; font-weight: 800; text-transform: uppercase; }
        .rating-box { background: #f8f9fa; padding: 12px; border-radius: 12px; border: 1px solid #eee; margin-bottom: 10px; }
        .rating-box label { display: block; font-weight: bold; font-size: 0.8rem; color: #555; margin-bottom: 5px; }
        .rating-box select { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 8px; font-size: 0.9rem; background: white; }
        
        .check-group { background:#fff5f5; padding: 15px; border-radius: 12px; border: 1px solid #ffe3e3; }
        .check-item { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; font-size: 0.85rem; cursor: pointer; }

        .step-container { display: none; padding: 10px; }
        .step-active { display: block; animation: fadeIn 0.4s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

    <div class="nav-toggle">
        <a id="nav-user" class="active" onclick="toggleMode('user')">USU√ÅRIO</a>
        <a id="nav-adm" onclick="toggleMode('adm')">ADM</a>
    </div>

    <div class="app-container">
        
        <div id="view-user">
            <div class="header">
                <h1>Avaliebus</h1>
                <p>Participe e ajude a melhorar a qualidade do transporte p√∫blico</p>
            </div>

            <div id="step1" class="step-container step-active">
                <div class="card" style="text-align: center; padding: 40px 20px;">
                    <div style="font-size: 4rem; margin-bottom: 15px;">üìç</div>
                    <h3>Chegou no ponto agora?</h3>
                    <p style="color: #666; font-size: 0.9rem;">Toque no bot√£o abaixo para iniciarmos a medi√ß√£o da sua espera.</p>
                    <button class="btn" style="background: var(--secondary); color:white;" onclick="startWait()">CHEGUEI NO PONTO AGORA</button>
                </div>
            </div>

            <div id="step2" class="step-container">
                <div class="card" style="text-align: center;">
                    <h3 style="color: #666;">Tempo de espera:</h3>
                    <div id="timer" style="font-size: 3.5rem; font-weight: 800; color: var(--secondary); margin: 20px 0; font-family: monospace;">00:00</div>
                    <button class="btn" style="background: var(--primary); color:white;" onclick="showStep(3)">SUBI NO √îNIBUS</button>
                </div>
            </div>

            <div id="step3" class="step-container">
                <div class="card">
                    <div style="background: #e1f5fe; color:#01579b; margin-bottom:20px; padding: 15px; border-radius: 12px; font-weight: bold; text-align: center; border: 1px solid #b3e5fc;">
                        ‚è±Ô∏è <span id="wait-msg-text"></span>
                    </div>

                    <div class="section-title">Identifica√ß√£o</div>
                    <input type="text" id="bus_line" class="btn" style="background:white; border:2px solid #ddd; text-align:center; color:black; cursor:text;" placeholder="N√∫mero da Linha">

                    <div class="section-title">Farol de Lota√ß√£o</div>
                    <div class="farol-container">
                        <button class="btn-lot btn-vazio" id="btn-v" onclick="setCrowd('Vazio', 'btn-v')">Vazio</button>
                        <button class="btn-lot btn-medio" id="btn-m" onclick="setCrowd('M√©dio', 'btn-m')">M√©dio</button>
                        <button class="btn-lot btn-lotado" id="btn-l" onclick="setCrowd('Lotado', 'btn-l')">Lotado</button>
                        <button class="btn-lot btn-super" id="btn-s" onclick="setCrowd('Imposs√≠vel', 'btn-s')">Imposs√≠vel</button>
                    </div>

                    <div class="section-title">Notas de Qualidade</div>
                    <div class="rating-box">
                        <label>Nota do Tempo de Espera</label>
                        <select id="r_esp"><option value="5">5‚òÖ Muito R√°pido</option><option value="4">4‚òÖ Bom</option><option value="3" selected>3‚òÖ Regular</option><option value="2">2‚òÖ Ruim</option><option value="1">1‚òÖ P√©ssimo</option></select>
                    </div>
                    <div class="rating-box">
                        <label>Motorista (Educa√ß√£o/Condu√ß√£o)</label>
                        <select id="r_mot"><option value="5">5‚òÖ</option><option value="4">4‚òÖ</option><option value="3" selected>3‚òÖ</option><option value="2">2‚òÖ</option><option value="1">1‚òÖ</option></select>
                    </div>
                    <div class="rating-box">
                        <label>Cobrador (Educa√ß√£o/Atendimento)</label>
                        <select id="r_cob"><option value="5">5‚òÖ</option><option value="4">4‚òÖ</option><option value="3" selected>3‚òÖ</option><option value="2">2‚òÖ</option><option value="1">1‚òÖ</option><option value="0">N√£o tem</option></select>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <div class="rating-box"><label>Limpeza</label><select id="r_lim"><option value="5">5‚òÖ</option><option value="3" selected>3‚òÖ</option><option value="1">1‚òÖ</option></select></div>
                        <div class="rating-box"><label>Bancos</label><select id="r_bnc"><option value="5">5‚òÖ</option><option value="3" selected>3‚òÖ</option><option value="1">1‚òÖ</option></select></div>
                    </div>

                    <div class="section-title">Presenciou algo do tipo hoje?</div>
                    <div class="check-group">
                        <label class="check-item"><input type="checkbox" id="c_v"> ü•ñ Vendedores Ambulantes</label>
                        <label class="check-item"><input type="checkbox" id="c_t"> üö™ Entraram pela porta de tr√°s</label>
                        <label class="check-item"><input type="checkbox" id="c_a"> ‚ö†Ô∏è Ass√©dio</label>
                        <label class="check-item"><input type="checkbox" id="c_r"> ‚ö†Ô∏è Assalto / Roubo</label>
                        <label class="check-item"><input type="checkbox" id="c_i"> Desrespeito a Idosos / PCD</label>
                        <label class="check-item"><input type="checkbox" id="c_b"> Brigas ou Confus√µes</label>
                        <label class="check-item"><input type="checkbox" id="c_d"> Dire√ß√£o Perigosa</label>
                    </div>

                    <input type="text" id="user_name" class="btn" style="background:white; border:2px solid #ddd; text-align:center; color:black; cursor:text; margin-top:20px;" placeholder="Seu Nome (Opcional)">
                    <button class="btn" style="background:var(--success-light); color:var(--dark);" onclick="finishSurvey()">ENVIAR AVALIA√á√ÉO</button>
                </div>
            </div>

            <div id="step4" class="step-container" style="text-align: center; padding: 60px 20px;">
                <div style="font-size: 5rem;">‚úÖ</div>
                <h2>Enviado com sucesso!</h2>
                <button class="btn" onclick="location.reload()" style="background:#eee; width:auto; padding:10px 40px; margin: 20px auto;">Nova Avalia√ß√£o</button>
            </div>
        </div>

        <div id="view-adm" style="display:none;">
            <div class="header header-adm">
                <h1>Painel ADM</h1>
                <p>Relat√≥rio de Qualidade e Ranking</p>
            </div>
            <div id="dashboard-content"></div>
            <div style="text-align: center; padding: 20px;"><button onclick="clearDatabase()" style="background:var(--danger); color:white; border:none; padding:12px; border-radius:8px; cursor:pointer; font-weight:bold;">LIMPAR BANCO DE DADOS</button></div>
        </div>
    </div>

    <script>
        let db = JSON.parse(localStorage.getItem('avaliebus_db')) || [];
        let startTime, waitInterval;
        let busData = { segs: 0, format: '', lot: '' };

        function toggleMode(m) {
            document.getElementById('view-user').style.display = m === 'user' ? 'block' : 'none';
            document.getElementById('view-adm').style.display = m === 'adm' ? 'block' : 'none';
            document.getElementById('nav-user').className = m === 'user' ? 'active' : '';
            document.getElementById('nav-adm').className = m === 'adm' ? 'active' : '';
            if(m === 'adm') renderDashboard();
        }

        function startWait() { 
            startTime = new Date(); showStep(2); 
            waitInterval = setInterval(() => {
                let d = Math.floor((new Date() - startTime) / 1000);
                document.getElementById('timer').innerText = Math.floor(d/60).toString().padStart(2,'0')+":"+(d%60).toString().padStart(2,'0');
                busData.segs = d; busData.format = `${Math.floor(d/60)}min e ${d%60}s`;
            }, 1000); 
        }

        function setCrowd(v, id) {
            busData.lot = v;
            document.querySelectorAll('.btn-lot').forEach(b => b.classList.remove('btn-selected'));
            document.getElementById(id).classList.add('btn-selected');
        }

        function showStep(n) {
            if(n === 3) { 
                clearInterval(waitInterval); 
                document.getElementById('wait-msg-text').innerText = `Voc√™ esperou exatamente ${busData.format} por este √¥nibus.`; 
            }
            document.querySelectorAll('.step-container').forEach(s => s.classList.remove('step-active'));
            document.getElementById('step'+n).classList.add('step-active');
            window.scrollTo(0,0);
        }

        function finishSurvey() {
            const linha = document.getElementById('bus_line').value;
            if(!linha || !busData.lot) { alert("Informe a Linha e a Lota√ß√£o!"); return; }

            db.push({
                linha: linha.toUpperCase(),
                espera_txt: busData.format,
                lot: busData.lot,
                nome: document.getElementById('user_name').value || "An√¥nimo",
                data: new Date().toLocaleDateString(),
                hora: new Date().toLocaleTimeString(),
                notas: {
                    esp: parseInt(document.getElementById('r_esp').value),
                    mot: parseInt(document.getElementById('r_mot').value),
                    cob: parseInt(document.getElementById('r_cob').value),
                    lim: parseInt(document.getElementById('r_lim').value),
                    bnc: parseInt(document.getElementById('r_bnc').value)
                },
                ocorr: [
                    document.getElementById('c_v').checked ? "Ambulantes" : null,
                    document.getElementById('c_t').checked ? "Porta Tr√°s" : null,
                    document.getElementById('c_a').checked ? "Ass√©dio" : null,
                    document.getElementById('c_r').checked ? "Assalto" : null,
                    document.getElementById('c_i').checked ? "PCD/Idosos" : null,
                    document.getElementById('c_b').checked ? "Briga" : null,
                    document.getElementById('c_d').checked ? "Perigo" : null
                ].filter(x => x)
            });
            localStorage.setItem('avaliebus_db', JSON.stringify(db));
            showStep(4);
        }

        function renderDashboard() {
            const container = document.getElementById('dashboard-content');
            container.innerHTML = "";
            if(db.length === 0) { container.innerHTML = "<p style='text-align:center; padding:30px;'>Nenhuma avalia√ß√£o encontrada.</p>"; return; }

            const linhas = {};
            db.forEach(av => {
                if(!linhas[av.linha]) linhas[av.linha] = { t:0, sE:0, sM:0, sC:0, cC:0, sL:0, sB:0, itens:[], freqOcorr:{} };
                const l = linhas[av.linha];
                l.t++; l.sE += av.notas.esp; l.sM += av.notas.mot; l.sL += av.notas.lim; l.sB += av.notas.bnc;
                if(av.notas.cob > 0) { l.sC += av.notas.cob; l.cC++; }
                l.itens.push(av);
                av.ocorr.forEach(o => l.freqOcorr[o] = (l.freqOcorr[o] || 0) + 1);
            });

            for(let l in linhas) {
                const i = linhas[l];
                let topOcorr = "Nenhuma ocorr√™ncia recorrente";
                let maxO = 0;
                for(let o in i.freqOcorr) { if(i.freqOcorr[o] > maxO) { maxO = i.freqOcorr[o]; topOcorr = o; } }

                const card = document.createElement('div');
                card.className = 'dash-card';
                card.innerHTML = `
                <div onclick="this.nextElementSibling.style.display = this.nextElementSibling.style.display === 'block' ? 'none' : 'block'">
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <strong>LINHA: ${l}</strong>
                        <span style="font-size:0.7rem;">${i.t} envios ‚ñæ</span>
                    </div>
                    <div class="ranking-resumo">
                        <div class="rank-item">‚è±Ô∏è Espera: <b>${(i.sE/i.t).toFixed(1)}</b></div>
                        <div class="rank-item">üë®‚Äç‚úàÔ∏è Moto: <b>${(i.sM/i.t).toFixed(1)}</b></div>
                        <div class="rank-item">üéüÔ∏è Cob: <b>${i.cC > 0 ? (i.sC/i.cC).toFixed(1) : 'N/A'}</b></div>
                        <div class="rank-item">üßπ Limp: <b>${(i.sL/i.t).toFixed(1)}</b></div>
                        <div class="alerta-problema">‚ö†Ô∏è Presenciou mais: ${topOcorr} (${maxO}x)</div>
                    </div>
                </div>
                <div class="details-area">
                    ${i.itens.slice().reverse().map(av => `
                        <div class="detail-item">
                            <b>${av.nome}</b> (${av.data} ${av.hora})<br>
                            ‚è±Ô∏è ${av.espera_txt} | üë• ${av.lot}<br>
                            <span class="tag-nota">Espera:${av.notas.esp}</span><span class="tag-nota">Moto:${av.notas.mot}</span><span class="tag-nota">Limp:${av.notas.lim}</span>
                            ${av.ocorr.length > 0 ? `<div style="color:var(--danger); font-weight:bold; margin-top:5px;">‚ö†Ô∏è ${av.ocorr.join(', ')}</div>` : ''}
                        </div>
                    `).join('')}
                </div>`;
                container.appendChild(card);
            }
        }

        function clearDatabase() { if(confirm("Apagar tudo?")) { db = []; localStorage.removeItem('avaliebus_db'); renderDashboard(); } }
    </script>
</body>
</html>